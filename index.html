<!DOCTYPE html>
<html class="dark" lang="zh-CN">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>海龟汤：守墓人之门</title>
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@100..700" rel="stylesheet"/>
    <style>
        body { background-color: #000; font-family: 'Noto Serif SC', serif; overflow: hidden; }
        .tombstone-btn { clip-path: polygon(10% 0%, 90% 0%, 100% 20%, 100% 100%, 0% 100%, 0% 20%); transition: 0.3s; }
        .tombstone-btn:hover:not(:disabled) { filter: brightness(1.4); transform: translateY(-3px); }
        
        @media (min-width: 1024px) {
            .game-wrapper { display: grid; grid-template-columns: 380px 1fr; gap: 0; max-width: 1400px; height: 90vh; border-radius: 24px; border: 1px solid rgba(115,17,212,0.2); }
            .side-library { display: flex !important; border-right: 1px solid rgba(255,255,255,0.05); }
        }

        .chat-msg { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        #chat-box::-webkit-scrollbar { width: 4px; }
        #chat-box::-webkit-scrollbar-thumb { background: #7311d4; border-radius: 10px; }
        .vignette { position: absolute; inset: 0; box-shadow: inset 0 0-150px rgba(0,0,0,0.9); pointer-events: none; z-index: 10; }
    </style>
</head>
<body class="text-gray-200 h-screen flex items-center justify-center p-0 md:p-8 bg-[url('https://images.unsplash.com/photo-1478720568477-152d9b164e26?q=80&w=2000')] bg-cover bg-center">
    <div class="absolute inset-0 bg-black/80 backdrop-blur-sm"></div>

    <div class="game-wrapper relative h-full w-full max-w-[500px] bg-zinc-950 shadow-2xl overflow-hidden z-20 flex flex-col md:flex-row">
        <div class="vignette"></div>

        <div id="side-lib" class="side-library hidden w-[380px] bg-black/40 flex-col p-6 z-30 overflow-y-auto">
            <h2 class="font-title text-3xl text-primary mb-8 tracking-widest">灵魂图书馆</h2>
            <div id="story-list" class="space-y-4"></div>
        </div>

        <div class="flex-grow flex flex-col relative">
            <div class="p-5 flex justify-between items-center bg-black/60 border-b border-white/5 z-30">
                <div class="flex items-center gap-3">
                    <button onclick="toggleMusic()" class="material-symbols-outlined text-primary text-xl">music_note</button>
                    <h3 id="current-story-name" class="font-bold text-sm tracking-widest text-gray-400 italic">请翻阅灵魂...</h3>
                </div>
                <div class="text-right">
                    <span id="sanity-display" class="text-xs font-black text-primary">SAN 100</span>
                </div>
            </div>

            <div id="chat-box" class="flex-grow p-6 overflow-y-auto space-y-6 z-20 relative">
                <div class="chat-msg bg-primary/10 border border-primary/20 p-6 rounded-2xl">
                    <h4 class="text-primary font-bold mb-2 flex items-center gap-2 text-sm">
                        <span class="material-symbols-outlined text-sm">auto_stories</span>
                        守墓人的启示
                    </h4>
                    <p class="text-[11px] leading-relaxed text-gray-400">
                        欢迎。真相只有『是』与『不是』。若无从下手，请试着探寻：<br><br>
                        • <strong class="text-gray-200">身份：</strong>死者是谁？他们之间有恩怨吗？<br>
                        • <strong class="text-gray-200">物品：</strong>汤面中出现的咖啡、纸条、火柴起到了什么作用？<br>
                        • <strong class="text-gray-200">动机：</strong>他是自愿的，还是被迫的？
                    </p>
                </div>
            </div>

            <div id="typing-indicator" class="hidden px-8 py-2 text-[10px] text-primary animate-pulse italic z-20">正在审视灵魂...</div>

            <div class="p-6 bg-zinc-900/90 border-t border-white/5 z-30 backdrop-blur-md">
                <div class="relative flex gap-2">
                    <input id="user-input" type="text" placeholder="向虚空提问..." 
                           class="flex-grow bg-white/5 border border-white/10 rounded-xl px-5 py-4 text-sm focus:outline-none focus:border-primary transition-all">
                    <button onclick="handleAsk()" class="bg-primary px-4 rounded-xl hover:scale-105 active:scale-95 transition-all">
                        <span class="material-symbols-outlined">send</span>
                    </button>
                </div>
                <div class="flex justify-between mt-4">
                    <button onclick="confirmTruth()" class="text-[9px] font-bold text-primary tracking-[0.2em] uppercase hover:text-white">提交最终真相</button>
                    <button onclick="showLibraryMobile()" class="md:hidden text-[9px] text-white/40 uppercase font-bold tracking-widest">翻阅灵魂</button>
                </div>
            </div>
        </div>
    </div>

    <div id="mobile-lib" class="fixed inset-0 z-[100] bg-black/95 p-8 hidden flex flex-col">
        <div class="flex justify-between items-center mb-8">
            <h2 class="font-title text-4xl text-primary">灵魂图书馆</h2>
            <button onclick="hideLibraryMobile()" class="material-symbols-outlined text-3xl text-white/40">close</button>
        </div>
        <div id="story-list-mobile" class="space-y-4 overflow-y-auto"></div>
    </div>

    <div id="modal-truth" class="fixed inset-0 z-[110] hidden flex items-center justify-center p-6 bg-black/90 backdrop-blur-xl">
        <div class="bg-zinc-900 border border-primary/30 p-8 rounded-3xl max-w-lg w-full">
            <h2 class="font-title text-3xl text-primary mb-6 text-center tracking-widest">真相揭晓</h2>
            <div id="truth-content" class="text-gray-300 text-sm leading-relaxed italic mb-8 bg-white/5 p-5 rounded-xl border border-white/5"></div>
            <button onclick="closeTruthModal()" class="w-full py-4 bg-primary rounded-xl font-bold tracking-[0.4em]">吸纳此魂并继续</button>
        </div>
    </div>

    <audio id="bg-music" loop src="https://assets.mixkit.co/music/preview/mixkit-horror-atmosphere-551.mp3"></audio>

<script>
    const STORIES = [
        { id: 0, name: "红色的汤", intro: "一名男子在一家高档餐厅点了一碗海龟汤。他喝了一口，面色凝重地询问店主：『这是真正的海龟汤吗？』。在得到肯定答复后，他走出店门，在倾盆大雨中自杀了。", truth: "他在荒岛吃过同伴杀掉父亲做的假汤，喝到真汤后意识到真相崩溃自杀。当年喝的是父亲的肉。", keys: ["父亲", "肉", "荒岛", "味道", "不同", "自杀", "吃人", "同伴"] },
        { id: 1, name: "消失的领航员", intro: "船长发现副手死在紧锁的舱内。副手手里攥着一张撕碎的纸条，桌上有没喝完的热咖啡。船长看了一眼咖啡，立刻跳进了海里自杀。", truth: "副手在咖啡里下毒想害死船长夺取求生机会。纸条是绝笔信。船长意识到唯一的伙伴背叛且自己可能中毒，选择跳海。", keys: ["下毒", "毒", "遗书", "纸条", "咖啡", "救生", "背叛", "跳海"] },
        { id: 2, name: "半张车票", intro: "男人从火车窗口看了一眼，随后惊恐跳车。此时火车正行驶在漫长的隧道边缘。", truth: "男人刚动完眼科手术复明。进入黑暗隧道后他以为手术失败再次失明，绝望之下跳车自杀。", keys: ["复明", "失明", "眼睛", "手术", "隧道", "黑暗", "火车"] },
        { id: 3, name: "阁楼的敲击声", intro: "独居女每晚听阁楼敲击声却从不报警。直到某天声响彻底停止，她走进阁楼后也选择了自杀。", truth: "她囚禁了恋人。敲击声是求救。声停代表恋人饿死，她在愧疚中随之而去。", keys: ["囚禁", "恋人", "求救", "饿死", "自杀", "关"] },
        { id: 4, name: "完美的合照", intro: "全家福合照中小明在哭。第二天，除了小明，全家人都死在了餐桌旁。", truth: "全家拍照前已煤气中毒身亡。小明用支架固定家人的尸体拍照，他哭是因为极度恐惧。", keys: ["尸体", "死人", "支架", "固定", "恐惧", "煤气"] },
        { id: 5, name: "只有一半的救生圈", intro: "海面漂着半个救生圈和一具抓着枪的尸体。死者死于溺水，但手里攥着左轮枪。", truth: "两人抽签决生死。死者输了，开枪自杀没中，最终在溺水中痛苦死去。", keys: ["抽签", "自杀", "开枪", "输", "左轮", "赌博"] },
        { id: 6, name: "致命的广播", intro: "电台主持人在直播间突然停止讲话。随后他在房间内自杀。邻居说当晚广播里的音乐异常刺耳。", truth: "主持人杀妻后伪造直播录音。但他发现录音带里录进了妻子的求救声，知道穿帮后选择自杀。", keys: ["杀人", "妻子", "录音", "穿帮", "证据", "求救"] },
        { id: 7, name: "盲人的礼物", intro: "盲人摸到礼盒内物件后，全身颤抖将其扔进垃圾桶。", truth: "盲人曾食人肉求生。礼物是朋友生前寄来的断臂，他摸到了熟悉的手表，明白当年吃了什么。", keys: ["手臂", "手", "肉", "手表", "熟悉", "朋友", "吃人"] },
        { id: 8, name: "最后一根火柴", intro: "雪地赤裸男尸，手攥烧过的短火柴，周围无脚印。", truth: "热气球超重。几人抽签决定谁跳下。死者抽到短火柴，被迫赤裸跳下减重身亡。", keys: ["热气球", "抽签", "火柴", "重量", "跳", "高度"] },
        { id: 9, name: "深夜的电梯", intro: "男人看了一眼电梯镜子，疯狂跑出电梯并倒地身亡。", truth: "镜子里反映出男人身后躲着杀人犯。男人在镜中看到刀尖，死于惊吓引发的心脏病。", keys: ["镜子", "背后", "杀人犯", "影子", "心脏病", "镜子"] }
    ];

    let state = JSON.parse(localStorage.getItem('soup_v4')) || { sanity: 100, activeId: 0, unlocked: 1 };
    let wrongCount = 0;

    function init() {
        renderLists();
        updateUI();
        if(state.activeId !== null) selectStory(state.activeId);
    }

    function renderLists() {
        const renderFunc = (containerId) => {
            const list = document.getElementById(containerId);
            list.innerHTML = STORIES.map((s, idx) => {
                const isLocked = idx >= state.unlocked;
                return `
                    <div onclick="${isLocked ? '' : `selectStory(${idx}); hideLibraryMobile();`}" 
                         class="p-4 rounded-xl border ${idx === state.activeId ? 'border-primary bg-primary/10' : 'border-white/5 bg-white/5'} 
                                ${isLocked ? 'opacity-20 grayscale cursor-not-allowed' : 'cursor-pointer hover:border-primary/50'} transition-all shadow-lg">
                        <div class="flex justify-between items-center text-xs">
                            <span class="font-bold tracking-widest">${isLocked ? '未觉醒的灵魂' : s.name}</span>
                            ${isLocked ? '<span class="material-symbols-outlined text-[10px]">lock</span>' : ''}
                        </div>
                    </div>
                `;
            }).join('');
        };
        renderFunc('story-list');
        renderFunc('story-list-mobile');
    }

    function selectStory(id) {
        state.activeId = id;
        const s = STORIES[id];
        document.getElementById('current-story-name').innerText = s.name;
        document.getElementById('chat-box').innerHTML += `
            <div class="chat-msg bg-white/5 border-l-2 border-primary p-5 rounded-r-xl text-xs italic text-gray-300 leading-relaxed">
                <span class="text-primary font-bold not-italic text-[10px] block mb-2 underline tracking-widest uppercase">New Mystery</span>
                ${s.intro}
            </div>
        `;
        save();
        renderLists();
    }

    function handleAsk() {
        const input = document.getElementById('user-input');
        const q = input.value.trim();
        if(!q || state.sanity < 5) return;

        appendMsg('user', q);
        input.value = '';
        state.sanity -= 5;
        updateUI();

        document.getElementById('typing-indicator').classList.remove('hidden');
        setTimeout(() => {
            document.getElementById('typing-indicator').classList.add('hidden');
            appendMsg('grave', getAIResponse(q));
        }, 800);
    }

    function getAIResponse(q) {
        const s = STORIES[state.activeId];
        const isRelated = s.keys.some(k => q.includes(k));
        if (isRelated) {
            wrongCount = 0;
            return "是。";
        } else {
            wrongCount++;
            if(wrongCount >= 4) {
                wrongCount = 0;
                const hint = s.keys[Math.floor(Math.random()*s.keys.length)];
                return "无关。守墓人的低语：去关注一下『" + hint + "』相关的事宜。";
            }
            const randomMiss = ["不是。", "无关。", "这不重要。", "并无联系。"];
            return randomMiss[Math.floor(Math.random()*randomMiss.length)];
        }
    }

    function appendMsg(role, text) {
        const box = document.getElementById('chat-box');
        const div = document.createElement('div');
        div.className = `chat-msg flex ${role === 'user' ? 'justify-end' : 'justify-start'}`;
        div.innerHTML = `<div class="${role === 'user' ? 'bg-zinc-800' : 'bg-primary/20 text-primary border border-primary/20'} px-4 py-2 rounded-2xl text-[11px] max-w-[85%] shadow-sm">${text}</div>`;
        box.appendChild(div);
        box.scrollTop = box.scrollHeight;
    }

    function confirmTruth() {
        document.getElementById('truth-content').innerText = STORIES[state.activeId].truth;
        document.getElementById('modal-truth').classList.remove('hidden');
    }

    function closeTruthModal() {
        document.getElementById('modal-truth').classList.add('hidden');
        if (state.activeId + 1 === state.unlocked && state.unlocked < STORIES.length) state.unlocked++;
        state.sanity = Math.min(100, state.sanity + 30);
        save();
        renderLists();
    }

    function updateUI() {
        document.getElementById('sanity-display').innerText = `SAN ${Math.floor(state.sanity)}`;
        save();
    }

    function save() { localStorage.setItem('soup_v4', JSON.stringify(state)); }
    function toggleMusic() {
        const m = document.getElementById('bg-music');
        m.paused ? m.play() : m.pause();
    }
    function showLibraryMobile() { document.getElementById('mobile-lib').classList.remove('hidden'); }
    function hideLibraryMobile() { document.getElementById('mobile-lib').classList.add('hidden'); }

    init();
</script>
</body>
</html>
