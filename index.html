<!DOCTYPE html>
<html class="dark" lang="zh-CN">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>海龟汤：守墓人之门</title>
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@100..700" rel="stylesheet"/>
    <style>
        body { background-color: #000; font-family: 'Noto Serif SC', serif; overflow: hidden; }
        .tombstone-btn { clip-path: polygon(10% 0%, 90% 0%, 100% 20%, 100% 100%, 0% 100%, 0% 20%); transition: 0.3s; }
        .tombstone-btn:hover:not(:disabled) { filter: brightness(1.4); transform: translateY(-3px); }
        
        @media (min-width: 1024px) {
            .game-wrapper { display: grid; grid-template-columns: 380px 1fr; gap: 0; max-width: 1400px; height: 90vh; border-radius: 24px; border: 1px solid rgba(115,17,212,0.2); }
            .side-library { display: flex !important; border-right: 1px solid rgba(255,255,255,0.05); }
        }

        .chat-msg { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        #chat-box::-webkit-scrollbar { width: 4px; }
        #chat-box::-webkit-scrollbar-thumb { background: #7311d4; border-radius: 10px; }
        .vignette { position: absolute; inset: 0; box-shadow: inset 0 0 150px rgba(0,0,0,0.9); pointer-events: none; z-index: 10; }
        
        /* 封面主界面样式 */
        #intro-layer { transition: all 1s ease-in-out; }
        .fade-out { opacity: 0; pointer-events: none; transform: scale(1.1); }
    </style>
</head>
<body class="text-gray-200 h-screen flex items-center justify-center p-0 md:p-8 bg-[url('https://images.unsplash.com/photo-1478720568477-152d9b164e26?q=80&w=2000')] bg-cover bg-center">
    
    <div id="intro-layer" class="fixed inset-0 z-[200] flex flex-col items-center justify-center bg-black">
        <div class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1505832018823-50331d70d237?q=80&w=1000')] bg-cover bg-center opacity-40 grayscale"></div>
        <div class="absolute inset-0 bg-gradient-to-b from-transparent via-black/60 to-black"></div>
        
        <div class="relative z-10 text-center space-y-6 px-6">
            <div class="space-y-2">
                <h1 class="font-title text-7xl md:text-8xl text-white tracking-widest animate-pulse">海龟汤</h1>
                <p class="text-primary tracking-[0.6em] text-xs md:text-sm font-bold uppercase">守 墓 人 之 门</p>
            </div>
            
            <div class="pt-12">
                <button onclick="enterGame()" class="w-64 h-16 bg-primary tombstone-btn font-bold text-xl tracking-widest shadow-[0_0_30px_rgba(115,17,212,0.4)]">
                    开启仪式
                </button>
                <p class="mt-4 text-white/20 text-[10px] tracking-widest">真相往往比谎言更荒诞</p>
            </div>
        </div>
    </div>

    <div class="absolute inset-0 bg-black/80 backdrop-blur-sm"></div>

    <div class="game-wrapper relative h-full w-full max-w-[500px] bg-zinc-950 shadow-2xl overflow-hidden z-20 flex flex-col md:flex-row">
        <div class="vignette"></div>

        <div id="side-lib" class="side-library hidden w-[380px] bg-black/40 flex-col p-6 z-30 overflow-y-auto">
            <h2 class="font-title text-3xl text-primary mb-8 tracking-widest">灵魂图书馆</h2>
            <div id="story-list" class="space-y-4"></div>
        </div>

        <div class="flex-grow flex flex-col relative">
            <div class="p-5 flex justify-between items-center bg-black/60 border-b border-white/5 z-30">
                <div class="flex items-center gap-3">
                    <button onclick="toggleMusic()" class="material-symbols-outlined text-primary text-xl">music_note</button>
                    <h3 id="current-story-name" class="font-bold text-sm tracking-widest text-gray-400 italic">请翻阅灵魂...</h3>
                </div>
                <div class="text-right">
                    <span id="sanity-display" class="text-xs font-black text-primary">SAN 100</span>
                </div>
            </div>

            <div id="chat-box" class="flex-grow p-6 overflow-y-auto space-y-6 z-20 relative">
                <div class="chat-msg bg-primary/10 border border-primary/20 p-6 rounded-2xl">
                    <h4 class="text-primary font-bold mb-2 flex items-center gap-2 text-sm">
                        <span class="material-symbols-outlined text-sm">auto_stories</span>
                        守墓人的启示
                    </h4>
                    <p class="text-[11px] leading-relaxed text-gray-400">
                        在这里，真相只有『是』与『不是』。请探寻身份、动机与异常细节。
                    </p>
                </div>
            </div>

            <div id="typing-indicator" class="hidden px-8 py-2 text-[10px] text-primary animate-pulse italic z-20">正在审视灵魂...</div>

            <div class="p-6 bg-zinc-900/90 border-t border-white/5 z-30 backdrop-blur-md">
                <div class="relative flex gap-2">
                    <input id="user-input" type="text" placeholder="向虚空提问..." 
                           class="flex-grow bg-white/5 border border-white/10 rounded-xl px-5 py-4 text-sm focus:outline-none focus:border-primary transition-all">
                    <button onclick="handleAsk()" class="bg-primary px-4 rounded-xl hover:scale-105 active:scale-95 transition-all">
                        <span class="material-symbols-outlined">send</span>
                    </button>
                </div>
                <div class="flex justify-between mt-4">
                    <button onclick="confirmTruth()" class="text-[9px] font-bold text-primary tracking-[0.2em] uppercase hover:text-white">提交最终真相</button>
                    <button onclick="showLibraryMobile()" class="md:hidden text-[9px] text-white/40 uppercase font-bold tracking-widest">翻阅灵魂</button>
                </div>
            </div>
        </div>
    </div>

    <div id="mobile-lib" class="fixed inset-0 z-[100] bg-black/95 p-8 hidden flex flex-col">
        <div class="flex justify-between items-center mb-8">
            <h2 class="font-title text-4xl text-primary">灵魂图书馆</h2>
            <button onclick="hideLibraryMobile()" class="material-symbols-outlined text-3xl text-white/40">close</button>
        </div>
        <div id="story-list-mobile" class="space-y-4 overflow-y-auto"></div>
    </div>

    <div id="modal-truth" class="fixed inset-0 z-[110] hidden flex items-center justify-center p-6 bg-black/90 backdrop-blur-xl">
        <div class="bg-zinc-900 border border-primary/30 p-8 rounded-3xl max-w-lg w-full">
            <h2 class="font-title text-3xl text-primary mb-6 text-center tracking-widest">真相揭晓</h2>
            <div id="truth-content" class="text-gray-300 text-sm leading-relaxed italic mb-8 bg-white/5 p-5 rounded-xl border border-white/5"></div>
            <button onclick="closeTruthModal()" class="w-full py-4 bg-primary rounded-xl font-bold tracking-[0.4em]">吸纳此魂并继续</button>
        </div>
    </div>

    <audio id="bg-music" loop src="https://assets.mixkit.co/music/preview/mixkit-horror-atmosphere-551.mp3"></audio>

<script>
    const STORIES = [
        { id: 0, name: "红色的汤", intro: "一名男子在餐厅喝了一口海龟汤，确认是真汤后，在雨中自杀了。", truth: "他在荒岛吃过同伴杀掉父亲做的假汤，喝到真汤后明白那是父亲的肉，崩溃自杀。", keys: ["父亲", "肉", "荒岛", "味道", "不同", "自杀", "吃人", "同伴"] },
        { id: 1, name: "消失的领航员", intro: "船长发现副手死在驾驶舱，手里抓着碎纸，桌上有咖啡。船长看了一眼立刻跳海。", truth: "副手在咖啡里下毒夺取生路，纸条是绝笔。船长见状明白伙伴背叛，万念俱灰跳海。", keys: ["下毒", "毒", "遗书", "纸条", "咖啡", "救生", "背叛", "跳海"] },
        { id: 2, name: "半张车票", intro: "男人看了一眼车窗外风景瞬间惊恐，随即在隧道边缘跳车身亡。", truth: "男人刚复明，进入隧道以为手术失败再次失明，绝望跳车。", keys: ["复明", "失明", "眼睛", "手术", "隧道", "黑暗"] },
        { id: 3, name: "阁楼敲击声", intro: "女人每晚听阁楼敲击声却不报警，声响停后她自杀了。", truth: "她囚禁恋人，敲击是求救，声停代表恋人饿死，她在愧疚中随之而去。", keys: ["囚禁", "恋人", "求救", "饿死", "自杀"] },
        { id: 4, name: "完美的合照", intro: "全家福里小明在哭。第二天，全家人除小明外都死在餐桌旁。", truth: "全家因煤气中毒已亡，小明用支架固定尸体合照，哭是因为极度恐惧。", keys: ["尸体", "支架", "固定", "恐惧", "煤气"] },
        { id: 5, name: "半个救生圈", intro: "海面漂着半个救生圈和一具抓着枪的尸体，死者死于溺水。", truth: "两人抽签决生死，死者输了，开枪自杀未遂最后溺毙。", keys: ["抽签", "自杀", "开枪", "输", "左轮"] },
        { id: 6, name: "致命的广播", intro: "主持人在直播间自杀，当晚广播音乐异常刺耳。", truth: "他杀妻伪造直播，但录音带录进求救声，他知道穿帮后自杀。", keys: ["杀人", "妻子", "录音", "穿帮", "证据", "求救"] },
        { id: 7, name: "盲人的礼物", intro: "盲人摸到礼盒内物件后扔进垃圾桶，全身颤抖。", truth: "他曾食人肉求生。礼物是朋友的断臂，他摸到了熟悉的手表。", keys: ["手臂", "肉", "手表", "熟悉", "朋友", "吃人"] },
        { id: 8, name: "最后火柴", intro: "雪地赤裸男尸攥着短火柴，周围一公里无脚印。", truth: "热气球超重，死者抽签抽到短火柴，被迫跳下减重。", keys: ["热气球", "抽签", "火柴", "跳", "高度"] },
        { id: 9, name: "深夜电梯", intro: "男人看了一眼电梯镜子，跑出电梯后倒地身亡。", truth: "镜子里反映出男人身后躲着杀人犯。男人受惊引发心脏病死亡。", keys: ["镜子", "背后", "杀人犯", "影子", "心脏病"] }
    ];

    let state = JSON.parse(localStorage.getItem('soup_v4')) || { sanity: 100, activeId: 0, unlocked: 1 };
    let wrongCount = 0;

    function init() {
        renderLists();
        updateUI();
        if(state.activeId !== null) selectStory(state.activeId);
    }

    // 进入游戏逻辑
    function enterGame() {
        document.getElementById('intro-layer').classList.add('fade-out');
        const m = document.getElementById('bg-music');
        m.play().catch(() => console.log("等待交互触发音频"));
    }

    function renderLists() {
        const renderFunc = (containerId) => {
            const list = document.getElementById(containerId);
            list.innerHTML = STORIES.map((s, idx) => {
                const isLocked = idx >= state.unlocked;
                return `
                    <div onclick="${isLocked ? '' : `selectStory(${idx}); hideLibraryMobile();`}" 
                         class="p-4 rounded-xl border ${idx === state.activeId ? 'border-primary bg-primary/10' : 'border-white/5 bg-white/5'} 
                                ${isLocked ? 'opacity-20 grayscale cursor-not-allowed' : 'cursor-pointer hover:border-primary/50'} transition-all shadow-lg">
                        <div class="flex justify-between items-center text-xs">
                            <span class="font-bold tracking-widest">${isLocked ? '未觉醒的灵魂' : s.name}</span>
                        </div>
                    </div>
                `;
            }).join('');
        };
        renderFunc('story-list');
        renderFunc('story-list-mobile');
    }

    function selectStory(id) {
        state.activeId = id;
        const s = STORIES[id];
        document.getElementById('current-story-name').innerText = s.name;
        document.getElementById('chat-box').innerHTML += `
            <div class="chat-msg bg-white/5 border-l-2 border-primary p-5 rounded-r-xl text-xs italic text-gray-300 leading-relaxed">
                <span class="text-primary font-bold not-italic text-[10px] block mb-2 underline tracking-widest uppercase">New Mystery</span>
                ${s.intro}
            </div>
        `;
        save();
        renderLists();
    }

    function handleAsk() {
        const input = document.getElementById('user-input');
        const q = input.value.trim();
        if(!q || state.sanity < 5) return;
        appendMsg('user', q);
        input.value = '';
        state.sanity -= 5;
        updateUI();
        document.getElementById('typing-indicator').classList.remove('hidden');
        setTimeout(() => {
            document.getElementById('typing-indicator').classList.add('hidden');
            appendMsg('grave', getAIResponse(q));
        }, 800);
    }

    function getAIResponse(q) {
        const s = STORIES[state.activeId];
        const isRelated = s.keys.some(k => q.includes(k));
        if (isRelated) {
            wrongCount = 0;
            return "是。";
        } else {
            wrongCount++;
            if(wrongCount >= 4) {
                wrongCount = 0;
                return "无关。提示：关注一下『" + s.keys[Math.floor(Math.random()*s.keys.length)] + "』。";
            }
            return "无关。";
        }
    }

    function appendMsg(role, text) {
        const box = document.getElementById('chat-box');
        const div = document.createElement('div');
        div.className = `chat-msg flex ${role === 'user' ? 'justify-end' : 'justify-start'}`;
        div.innerHTML = `<div class="${role === 'user' ? 'bg-zinc-800' : 'bg-primary/20 text-primary border border-primary/20'} px-4 py-2 rounded-2xl text-[11px] max-w-[85%] shadow-sm">${text}</div>`;
        box.appendChild(div);
        box.scrollTop = box.scrollHeight;
    }

    function confirmTruth() {
        document.getElementById('truth-content').innerText = STORIES[state.activeId].truth;
        document.getElementById('modal-truth').classList.remove('hidden');
    }

    function closeTruthModal() {
        document.getElementById('modal-truth').classList.add('hidden');
        if (state.activeId + 1 === state.unlocked && state.unlocked < STORIES.length) state.unlocked++;
        state.sanity = Math.min(100, state.sanity + 30);
        save();
        renderLists();
    }

    function updateUI() {
        document.getElementById('sanity-display').innerText = `SAN ${Math.floor(state.sanity)}`;
        save();
    }

    function save() { localStorage.setItem('soup_v4', JSON.stringify(state)); }
    function toggleMusic() {
        const m = document.getElementById('bg-music');
        m.paused ? m.play() : m.pause();
    }
    function showLibraryMobile() { document.getElementById('mobile-lib').classList.remove('hidden'); }
    function hideLibraryMobile() { document.getElementById('mobile-lib').classList.add('hidden'); }

    init();
</script>
</body>
</html>
