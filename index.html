<!DOCTYPE html>
<html class="dark" lang="zh-CN">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>海龟汤：守墓人之门</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@100..700" rel="stylesheet"/>
    <style>
        body { background-color: #000; font-family: 'Noto Serif SC', serif; margin: 0; overflow: hidden; }
        @media (min-width: 1024px) {
            .game-container { display: grid; grid-template-columns: 320px 1fr; width: 100vw; height: 100vh; }
            .side-library { display: flex !important; border-right: 1px solid rgba(115, 17, 212, 0.2); }
        }
        @media (max-width: 1023px) {
            .game-container { display: flex; flex-direction: column; width: 100vw; height: 100vh; }
            .side-library { display: none; }
        }
        .tombstone-btn { clip-path: polygon(10% 0%, 90% 0%, 100% 20%, 100% 100%, 0% 100%, 0% 20%); transition: 0.3s; cursor: pointer; }
        .tombstone-btn:hover:not(:disabled) { filter: brightness(1.4); transform: translateY(-3px); }
        .tombstone-btn:active { transform: translateY(1px); }
        #chat-box::-webkit-scrollbar { width: 6px; }
        #chat-box::-webkit-scrollbar-thumb { background: #7311d4; border-radius: 10px; }
        #intro-layer { position: fixed; inset: 0; z-index: 999; background: radial-gradient(circle, #1a052e 0%, #000 100%); display: flex; flex-direction: column; align-items: center; justify-content: center; transition: all 0.8s ease; }
        .fade-out { opacity: 0; pointer-events: none; transform: scale(1.05); }
        .glass-panel { background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(12px); border: 1px solid rgba(115, 17, 212, 0.3); }
    </style>
</head>
<body class="text-gray-200">

    <div id="intro-layer">
        <div class="text-center space-y-8 p-6">
            <h1 class="font-title text-8xl md:text-9xl text-white drop-shadow-[0_0_20px_rgba(115,17,212,0.8)]">海龟汤</h1>
            <p class="text-primary tracking-[0.8em] text-sm font-bold uppercase">守 墓 人 之 门</p>
            <div class="pt-10">
                <button onclick="enterGame()" class="w-72 h-20 bg-primary tombstone-btn font-bold text-2xl tracking-widest text-white">
                    开启仪式
                </button>
                <p id="save-hint" class="mt-4 text-white/40 text-xs tracking-widest">检测到灵魂印记，将继续您的旅程</p>
            </div>
        </div>
    </div>

    <div class="game-container bg-zinc-950">
        <aside class="side-library hidden flex-col bg-black/60 p-6 overflow-y-auto">
            <h2 class="font-title text-3xl text-primary mb-10 tracking-widest text-center">灵魂图书馆</h2>
            <div id="story-list" class="space-y-4"></div>
        </aside>

        <main class="flex flex-col relative">
            <header class="p-5 flex justify-between items-center bg-black/80 border-b border-primary/20 z-10">
                <div class="flex items-center gap-4">
                    <button onclick="toggleMusic()" id="music-btn" class="material-symbols-outlined text-primary text-2xl">music_note</button>
                    <h3 id="current-story-name" class="font-bold text-lg tracking-widest text-gray-400">选择关卡...</h3>
                </div>
                <div class="flex items-center gap-4">
                    <div id="sanity-display" class="font-black text-primary mr-4">SAN 100</div>
                    <button onclick="toggleSettings(true)" class="material-symbols-outlined text-gray-500 hover:text-white transition-colors">settings</button>
                </div>
            </header>

            <div id="chat-box" class="flex-grow p-8 overflow-y-auto space-y-6 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')]">
            </div>

            <footer class="p-8 bg-black border-t border-primary/10">
                <div class="max-w-5xl mx-auto flex gap-4">
                    <input id="user-input" type="text" placeholder="向虚空提问..." 
                           class="flex-grow bg-white/5 border border-white/10 rounded-2xl px-6 py-4 text-lg focus:outline-none focus:border-primary transition-all">
                    <button onclick="handleAsk()" class="bg-primary px-8 rounded-2xl hover:scale-105 active:scale-95 transition-all">
                        <span class="material-symbols-outlined">send</span>
                    </button>
                </div>
                <div class="max-w-5xl mx-auto flex justify-between mt-4 px-2">
                    <button onclick="confirmTruth()" class="text-[10px] font-bold text-primary tracking-widest uppercase hover:text-white">提交最终真相</button>
                    <button onclick="showLibraryMobile()" class="lg:hidden text-[10px] text-white/40">关卡列表</button>
                </div>
            </footer>
        </main>
    </div>

    <div id="settings-modal" class="fixed inset-0 z-[1000] hidden flex items-center justify-center bg-black/80 backdrop-blur-md">
        <div class="glass-panel p-10 rounded-3xl w-80 space-y-8 text-center">
            <h2 class="font-title text-3xl text-primary">仪式设置</h2>
            <div class="space-y-4">
                <button onclick="exitToTitle()" class="w-full py-4 border border-white/10 rounded-xl hover:bg-white/5 transition-all">退出到主界面</button>
                <button onclick="resetGame()" class="w-full py-4 border border-red-900/50 text-red-500 rounded-xl hover:bg-red-500/10 transition-all">重置所有进度</button>
            </div>
            <button onclick="toggleSettings(false)" class="text-sm text-gray-500 underline uppercase tracking-widest">返回游戏</button>
        </div>
    </div>

    <div id="modal-truth" class="fixed inset-0 z-[110] hidden flex items-center justify-center p-6 bg-black/90 backdrop-blur-xl">
        <div class="glass-panel p-10 rounded-3xl max-w-2xl w-full">
            <h2 class="font-title text-4xl text-primary mb-6 text-center">真相揭晓</h2>
            <div id="truth-content" class="text-gray-300 text-lg leading-relaxed italic mb-10 bg-white/5 p-6 rounded-2xl"></div>
            <button onclick="unlockNextAndClose()" class="w-full py-5 bg-primary rounded-2xl font-bold text-xl tracking-widest text-white">吸纳此魂并继续</button>
        </div>
    </div>

    <audio id="bg-music" loop src="https://assets.mixkit.co/music/preview/mixkit-horror-atmosphere-551.mp3"></audio>

<script>
    const STORIES = [
        { id: 0, name: "第一关：红色的汤", intro: "一名男子在一家高档餐厅点了一碗海龟汤。他喝了一口，面色凝重地询问店主：『这是真正的海龟汤吗？』。在得到肯定答复后，他走出店门，在倾盆大雨中自杀了。", truth: "他在荒岛吃过同伴杀掉父亲做的假汤，喝到真汤后意识到真相崩溃自杀。当年喝的是父亲的肉。", keys: ["父亲", "肉", "荒岛", "味道", "不同", "自杀", "吃人", "同伴"] },
        { id: 1, name: "第二关：消失的领航员", intro: "船长发现副手死在紧锁的舱内。副手手里攥着一张撕碎的纸条，桌上有没喝完的热咖啡。船长看了一眼咖啡，立刻跳进了海里自杀。", truth: "副手在咖啡里下毒想害死船长夺取求生机会。纸条是绝笔信。船长意识到唯一的伙伴背叛且自己可能中毒，选择跳海。", keys: ["下毒", "毒", "遗书", "纸条", "咖啡", "救生", "背叛", "跳海"] },
        { id: 2, name: "第三关：半张车票", intro: "男人从火车窗口看了一眼，随后惊恐跳车。此时火车正行驶在漫长的隧道边缘。", truth: "男人刚动完眼科手术复明。进入黑暗隧道后他以为手术失败再次失明，绝望之下跳车自杀。", keys: ["复明", "失明", "眼睛", "手术", "隧道", "黑暗", "火车"] },
        { id: 3, name: "第四关：阁楼的敲击声", intro: "独居女每晚听阁楼敲击声却从不报警。直到某天声响彻底停止，她走进阁楼后也选择了自杀。", truth: "她囚禁了恋人。敲击声是求救。声停代表恋人饿死，她在愧疚中随之而去。", keys: ["囚禁", "恋人", "求救", "饿死", "自杀", "关"] },
        { id: 4, name: "第五关：完美的合照", intro: "全家福合照中小明在哭。第二天，除了小明，全家人都死在了餐桌旁。", truth: "全家拍照前已煤气中毒身亡。小明用支架固定家人的尸体拍照，他哭是因为极度恐惧。", keys: ["尸体", "死人", "支架", "固定", "恐惧", "煤气"] },
        { id: 5, name: "第六关：只有一半的救生圈", intro: "海面漂着半个救生圈和一具抓着枪的尸体。死者死于溺水，但手里攥着左轮枪。", truth: "两人抽签决生死。死者输了，开枪自杀没中，最终在溺水中痛苦死去。", keys: ["抽签", "自杀", "开枪", "输", "左轮", "赌博"] },
        { id: 6, name: "第七关：致命的广播", intro: "电台主持人在直播间突然停止讲话。随后他在房间内自杀。邻居说当晚广播里的音乐异常刺耳。", truth: "主持人杀妻后伪造直播录音。但他发现录音带里录进了妻子的求救声，知道穿帮后选择自杀。", keys: ["杀人", "妻子", "录音", "穿帮", "证据", "求救"] },
        { id: 7, name: "第八关：盲人的礼物", intro: "盲人摸到礼盒内物件后，全身颤抖将其扔进垃圾桶。", truth: "盲人曾食人肉求生。礼物是朋友生前寄来的断臂，他摸到了熟悉的手表，明白当年吃了什么。", keys: ["手臂", "手", "肉", "手表", "熟悉", "朋友", "吃人"] },
        { id: 8, name: "第九关：最后一根火柴", intro: "雪地赤裸男尸，手攥烧过的短火柴，周围无脚印。", truth: "热气球超重。几人抽签决定谁跳下。死者抽到短火柴，被迫赤裸跳下减重身亡。", keys: ["热气球", "抽签", "火柴", "重量", "跳", "高度"] },
        { id: 9, name: "第十关：深夜的电梯", intro: "男人看了一眼电梯镜子，疯狂跑出电梯并倒地身亡。", truth: "镜子里反映出男人身后躲着杀人犯。男人在镜中看到刀尖，死于惊吓引发的心脏病。", keys: ["镜子", "背后", "杀人犯", "影子", "心脏病", "镜子"] }
        // 更多故事可以继续添加...
    ];

    // 初始化进度
    let state = JSON.parse(localStorage.getItem('soup_save_v1')) || { unlocked: 1, activeId: 0, sanity: 100 };

    function init() {
        document.getElementById('save-hint').style.display = state.unlocked > 1 ? 'block' : 'none';
        renderLists();
        updateUI();
        loadStory(state.activeId);
    }

    function enterGame() {
        document.getElementById('intro-layer').classList.add('fade-out');
        const m = document.getElementById('bg-music');
        m.play().catch(() => {});
    }

    function exitToTitle() {
        document.getElementById('intro-layer').classList.remove('fade-out');
        toggleSettings(false);
    }

    function toggleSettings(show) {
        document.getElementById('settings-modal').style.display = show ? 'flex' : 'none';
    }

    function resetGame() {
        if(confirm("确定要抹除所有灵魂印记（进度）吗？此操作不可撤销。")) {
            localStorage.removeItem('soup_save_v1');
            location.reload();
        }
    }

    function renderLists() {
        const render = (id) => {
            const list = document.getElementById(id);
            list.innerHTML = STORIES.map((s, idx) => {
                const isLocked = idx >= state.unlocked;
                const isActive = idx === state.activeId;
                return `
                    <div onclick="${isLocked ? '' : `loadStory(${idx})`}" 
                         class="p-5 rounded-2xl border ${isActive ? 'border-primary bg-primary/20' : 'border-white/5 bg-white/5'} 
                                ${isLocked ? 'opacity-30 cursor-not-allowed' : 'cursor-pointer hover:border-primary/50'} transition-all">
                        <div class="flex justify-between items-center">
                            <span class="font-bold text-sm tracking-widest">${isLocked ? '??? 锁闭中' : s.name}</span>
                            ${isLocked ? '<span class="material-symbols-outlined text-sm">lock</span>' : ''}
                        </div>
                    </div>
                `;
            }).join('');
        };
        render('story-list');
    }

    function loadStory(id) {
        state.activeId = id;
        document.getElementById('current-story-name').innerText = STORIES[id].name;
        document.getElementById('chat-box').innerHTML = `
            <div class="max-w-4xl mx-auto bg-primary/5 border border-primary/20 p-8 rounded-3xl mb-6">
                <p class="text-gray-400 italic text-lg leading-relaxed">${STORIES[id].intro}</p>
            </div>
        `;
        save();
        renderLists();
    }

    function handleAsk() {
        const input = document.getElementById('user-input');
        const q = input.value.trim();
        if(!q) return;
        appendMsg('user', q);
        input.value = '';
        setTimeout(() => appendMsg('grave', checkLogic(q)), 600);
    }

    function checkLogic(q) {
        const s = STORIES[state.activeId];
        const isMatch = s.keys.some(k => q.includes(k));
        return isMatch ? "是。" : (Math.random() > 0.5 ? "不是。" : "无关。");
    }

    function appendMsg(role, text) {
        const box = document.getElementById('chat-box');
        const div = document.createElement('div');
        div.className = `flex max-w-4xl mx-auto mb-4 ${role === 'user' ? 'justify-end' : 'justify-start'}`;
        div.innerHTML = `<div class="${role === 'user' ? 'bg-zinc-800' : 'bg-primary/20 text-primary border border-primary/20'} px-6 py-3 rounded-2xl shadow-lg">${text}</div>`;
        box.appendChild(div);
        box.scrollTop = box.scrollHeight;
    }

    function confirmTruth() {
        document.getElementById('truth-content').innerText = STORIES[state.activeId].truth;
        document.getElementById('modal-truth').classList.remove('hidden');
    }

    function unlockNextAndClose() {
        if (state.activeId + 1 === state.unlocked && state.unlocked < STORIES.length) {
            state.unlocked++;
        }
        document.getElementById('modal-truth').classList.add('hidden');
        save();
        renderLists();
    }

    function save() { localStorage.setItem('soup_save_v1', JSON.stringify(state)); }
    function updateUI() { document.getElementById('sanity-display').innerText = `SAN ${state.sanity}`; }
    function toggleMusic() {
        const m = document.getElementById('bg-music');
        m.paused ? m.play() : m.pause();
    }

    init();
</script>
</body>
</html>
