<!DOCTYPE html>
<html class="dark" lang="zh-CN">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>海龟汤：守墓人之门</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@100..700" rel="stylesheet"/>
    <style>
        body { background-color: #000; font-family: 'Noto Serif SC', serif; margin: 0; overflow: hidden; }
        .tombstone-btn { clip-path: polygon(10% 0%, 90% 0%, 100% 20%, 100% 100%, 0% 100%, 0% 20%); transition: 0.3s; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .tombstone-btn:hover:not(:disabled) { filter: brightness(1.4); transform: translateY(-3px); box-shadow: 0 0 30px rgba(115, 17, 212, 0.5); }
        
        #chat-box::-webkit-scrollbar { width: 4px; }
        #chat-box::-webkit-scrollbar-thumb { background: #7311d4; border-radius: 10px; }
        
        .page-layer { position: fixed; inset: 0; transition: all 0.6s ease-in-out; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10; background: #000; }
        .hidden-layer { opacity: 0; pointer-events: none; transform: scale(1.1); }
        .visible-layer { opacity: 1; pointer-events: auto; transform: scale(1); }

        .menu-bg { background: radial-gradient(circle, #1a052e 0%, #000 100%); }
        .hint-text { color: #facc15; font-style: italic; border-left: 2px solid #facc15; padding-left: 10px; }
    </style>
</head>
<body class="text-gray-200">

    <div id="layer-gate" class="page-layer visible-layer">
        <div class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1505832018823-50331d70d237?q=80&w=1000')] bg-cover bg-center opacity-30"></div>
        <div class="absolute inset-0 bg-black/40"></div>
        <div class="relative z-20 flex flex-col items-center justify-center text-center">
            <div class="space-y-4 mb-16">
                <h1 class="font-title text-8xl md:text-9xl text-white drop-shadow-[0_0_20px_rgba(115,17,212,0.8)]">海龟汤</h1>
                <p class="text-primary tracking-[0.8em] text-sm font-bold opacity-80 uppercase">守 墓 人 之 门</p>
            </div>
            <button onclick="switchPage('layer-gate', 'layer-menu')" class="w-72 h-20 bg-primary tombstone-btn font-bold text-2xl tracking-widest text-white shadow-2xl">
                开启仪式
            </button>
            <p class="mt-8 text-white/20 text-[10px] tracking-[0.5em]">TRUTH IS BURIED DEEP</p>
        </div>
    </div>

    <div id="layer-menu" class="page-layer hidden-layer menu-bg">
        <div class="text-center space-y-12">
            <div class="space-y-2">
                <h2 class="text-primary tracking-widest text-xs uppercase opacity-60">—— 灵魂驻留处 ——</h2>
                <h3 class="text-4xl font-bold tracking-[0.5em]">主菜单</h3>
            </div>
            
            <div class="flex flex-col gap-6 w-80">
                <button onclick="continueGame()" class="h-16 border border-primary/40 rounded-xl hover:bg-primary/10 transition-all font-bold tracking-widest text-lg flex items-center justify-center gap-3 text-white">
                    <span class="material-symbols-outlined">play_arrow</span> 继续解谜
                </button>
                <button onclick="switchPage('layer-menu', 'layer-library')" class="h-16 border border-white/10 rounded-xl hover:bg-white/5 transition-all tracking-widest text-lg flex items-center justify-center gap-3 text-white">
                    <span class="material-symbols-outlined">auto_stories</span> 灵魂图书馆
                </button>
                <button onclick="toggleSettings(true)" class="h-16 border border-white/10 rounded-xl hover:bg-white/5 transition-all tracking-widest text-lg flex items-center justify-center gap-3 text-white">
                    <span class="material-symbols-outlined">settings</span> 祭坛设置
                </button>
            </div>

            <button onclick="switchPage('layer-menu', 'layer-gate')" class="text-xs text-white/30 uppercase tracking-[0.4em] hover:text-white transition-colors">回到门外</button>
        </div>
    </div>

    <div id="layer-library" class="page-layer hidden-layer bg-zinc-950">
        <div class="w-full max-w-4xl p-8 space-y-10 overflow-y-auto">
            <div class="flex justify-between items-end border-b border-primary/20 pb-6">
                <h2 class="font-title text-6xl text-primary">灵魂图书馆</h2>
                <button onclick="switchPage('layer-library', 'layer-menu')" class="text-primary flex items-center gap-2 underline text-sm">返回菜单</button>
            </div>
            <div id="story-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6 pb-20"></div>
        </div>
    </div>

    <div id="layer-game" class="page-layer hidden-layer">
        <div class="w-full h-full flex flex-col bg-zinc-950">
            <header class="p-6 flex justify-between items-center border-b border-white/5 bg-black/40">
                <div class="flex items-center gap-4">
                    <button onclick="switchPage('layer-game', 'layer-menu')" class="material-symbols-outlined text-gray-500 hover:text-white">arrow_back</button>
                    <h3 id="current-story-name" class="font-bold tracking-widest text-primary">...</h3>
                </div>
                <div class="text-primary font-black tracking-tighter" id="sanity-display">SAN 100</div>
            </header>

            <div id="chat-box" class="flex-grow p-8 overflow-y-auto space-y-6"></div>

            <footer class="p-8 bg-black/60 border-t border-white/5">
                <div class="max-w-4xl mx-auto flex gap-4 items-center">
                    <button onclick="getHint()" class="p-4 rounded-2xl bg-white/5 border border-white/10 text-yellow-500 hover:bg-yellow-500/10 transition-all shadow-lg" title="获取提示">
                        <span class="material-symbols-outlined">lightbulb</span>
                    </button>
                    
                    <input id="user-input" type="text" placeholder="在此提问，回车发送..." 
                           onkeydown="if(event.key === 'Enter') handleAsk()"
                           class="flex-grow bg-white/5 border border-white/10 rounded-2xl px-6 py-4 text-lg focus:outline-none focus:border-primary transition-all text-white">
                    
                    <button onclick="handleAsk()" class="bg-primary px-8 py-4 rounded-2xl text-white shadow-lg">
                        <span class="material-symbols-outlined">send</span>
                    </button>
                </div>
                <div class="text-center mt-4 flex justify-center gap-8">
                    <button onclick="confirmTruth()" class="text-[10px] font-bold text-primary tracking-[0.3em] uppercase opacity-60 hover:opacity-100 transition-all">探寻最终真相</button>
                </div>
            </footer>
        </div>
    </div>

    <div id="settings-modal" class="fixed inset-0 z-[2000] hidden flex items-center justify-center bg-black/90 backdrop-blur-sm">
        <div class="bg-zinc-900 border border-primary/20 p-10 rounded-3xl w-80 text-center space-y-6 shadow-2xl">
            <h2 class="text-2xl font-bold text-primary">设置</h2>
            <button onclick="toggleMusic()" class="w-full py-4 bg-white/5 rounded-xl hover:bg-white/10 text-white">切换音乐 开启/关闭</button>
            <button onclick="resetGame()" class="w-full py-4 text-red-500 border border-red-900/30 rounded-xl font-bold hover:bg-red-500/5">重置存档</button>
            <button onclick="toggleSettings(false)" class="text-sm underline text-gray-500">返回</button>
        </div>
    </div>

    <div id="modal-truth" class="fixed inset-0 z-[2000] hidden flex items-center justify-center p-6 bg-black/95 backdrop-blur-xl">
        <div class="bg-zinc-900 border border-primary/30 p-10 rounded-3xl max-w-2xl w-full shadow-2xl">
            <h2 class="font-title text-4xl text-primary mb-6 text-center">真相揭晓</h2>
            <div id="truth-content" class="text-gray-300 text-lg italic mb-10 bg-white/5 p-6 rounded-2xl border border-white/5"></div>
            <button onclick="unlockNextAndClose()" class="w-full py-5 bg-primary rounded-2xl font-bold text-xl text-white shadow-xl">吸纳此魂并继续</button>
        </div>
    </div>

    <audio id="bg-music" loop src="https://assets.mixkit.co/music/preview/mixkit-horror-atmosphere-551.mp3"></audio>

<script>
   const STORIES = [
        { id: 0, name: "第一关：红色的汤", intro: "一名男子在一家高档餐厅点了一碗海龟汤。他喝了一口，面色凝重地询问店主：『这是真正的海龟汤吗？』。在得到肯定答复后，他走出店门，在倾盆大雨中自杀了。", truth: "他在荒岛吃过同伴杀掉父亲做的假汤，喝到真汤后意识到真相崩溃自杀。当年喝的是父亲的肉。", keys: ["父亲", "肉", "荒岛", "味道", "不同", "自杀", "吃人", "同伴"] },
        { id: 1, name: "第二关：消失的领航员", intro: "船长发现副手死在紧锁的舱内。副手手里攥着一张撕碎的纸条，桌上有没喝完的热咖啡。船长看了一眼咖啡，立刻跳进了海里自杀。", truth: "副手在咖啡里下毒想害死船长夺取求生机会。纸条是绝笔信。船长意识到唯一的伙伴背叛且自己可能中毒，选择跳海。", keys: ["下毒", "毒", "遗书", "纸条", "咖啡", "救生", "背叛", "跳海"] },
        { id: 2, name: "第三关：半张车票", intro: "男人从火车窗口看了一眼，随后惊恐跳车。此时火车正行驶在漫长的隧道边缘。", truth: "男人刚动完眼科手术复明。进入黑暗隧道后他以为手术失败再次失明，绝望之下跳车自杀。", keys: ["复明", "失明", "眼睛", "手术", "隧道", "黑暗", "火车"] },
        { id: 3, name: "第四关：阁楼的敲击声", intro: "独居女每晚听阁楼敲击声却从不报警。直到某天声响彻底停止，她走进阁楼后也选择了自杀。", truth: "她囚禁了恋人。敲击声是求救。声停代表恋人饿死，她在愧疚中随之而去。", keys: ["囚禁", "恋人", "求救", "饿死", "自杀", "关"] },
        { id: 4, name: "第五关：完美的合照", intro: "全家福合照中小明在哭。第二天，除了小明，全家人都死在了餐桌旁。", truth: "全家拍照前已煤气中毒身亡。小明用支架固定家人的尸体拍照，他哭是因为极度恐惧。", keys: ["尸体", "死人", "支架", "固定", "恐惧", "煤气"] },
        { id: 5, name: "第六关：只有一半的救生圈", intro: "海面漂着半个救生圈和一具抓着枪的尸体。死者死于溺水，但手里攥着左轮枪。", truth: "两人抽签决生死。死者输了，开枪自杀没中，最终在溺水中痛苦死去。", keys: ["抽签", "自杀", "开枪", "输", "左轮", "赌博"] },
        { id: 6, name: "第七关：致命的广播", intro: "电台主持人在直播间突然停止讲话。随后他在房间内自杀。邻居说当晚广播里的音乐异常刺耳。", truth: "主持人杀妻后伪造直播录音。但他发现录音带里录进了妻子的求救声，知道穿帮后选择自杀。", keys: ["杀人", "妻子", "录音", "穿帮", "证据", "求救"] },
        { id: 7, name: "第八关：盲人的礼物", intro: "盲人摸到礼盒内物件后，全身颤抖将其扔进垃圾桶。", truth: "盲人曾食人肉求生。礼物是朋友生前寄来的断臂，他摸到了熟悉的手表，明白当年吃了什么。", keys: ["手臂", "手", "肉", "手表", "熟悉", "朋友", "吃人"] },
        { id: 8, name: "第九关：最后一根火柴", intro: "雪地赤裸男尸，手攥烧过的短火柴，周围无脚印。", truth: "热气球超重。几人抽签决定谁跳下。死者抽到短火柴，被迫赤裸跳下减重身亡。", keys: ["热气球", "抽签", "火柴", "重量", "跳", "高度"] },
        { id: 9, name: "第十关：深夜的电梯", intro: "男人看了一眼电梯镜子，疯狂跑出电梯并倒地身亡。", truth: "镜子里反映出男人身后躲着杀人犯。男人在镜中看到刀尖，死于惊吓引发的心脏病。", keys: ["镜子", "背后", "杀人犯", "影子", "心脏病", "镜子"] }
        // 更多故事可以继续添加...
    ];

    let state = JSON.parse(localStorage.getItem('soup_pro_v2')) || { unlocked: 1, activeId: 0, sanity: 100 };

    function switchPage(fromId, toId) {
        document.querySelectorAll('.page-layer').forEach(l => {
            l.classList.add('hidden-layer');
            l.classList.remove('visible-layer');
        });
        const target = document.getElementById(toId);
        target.classList.remove('hidden-layer');
        target.classList.add('visible-layer');
        if(toId === 'layer-library') renderLibrary();
    }

    function continueGame() {
        loadStory(state.activeId);
        switchPage('layer-menu', 'layer-game');
    }

    function renderLibrary() {
        const grid = document.getElementById('story-grid');
        grid.innerHTML = STORIES.map((s, idx) => {
            const isLocked = idx >= state.unlocked;
            return `
                <div onclick="${isLocked ? '' : `loadStory(${idx}); switchPage('layer-library', 'layer-game')`}" 
                     class="p-8 rounded-3xl border ${idx === state.activeId ? 'border-primary bg-primary/10' : 'border-white/5 bg-white/5'} 
                            ${isLocked ? 'opacity-30' : 'cursor-pointer hover:border-primary/50'} transition-all shadow-lg">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs text-primary font-bold uppercase tracking-widest">Soul #${idx + 1}</span>
                        ${isLocked ? '<span class="material-symbols-outlined">lock</span>' : ''}
                    </div>
                    <h3 class="text-xl font-bold tracking-widest">${isLocked ? '未感应的灵魂' : s.name}</h3>
                </div>
            `;
        }).join('');
    }

    function loadStory(id) {
        state.activeId = id;
        document.getElementById('current-story-name').innerText = STORIES[id].name;
        document.getElementById('chat-box').innerHTML = `
            <div class="max-w-4xl mx-auto bg-primary/5 border border-primary/20 p-10 rounded-[2rem] shadow-2xl mb-10">
                <p class="text-gray-300 italic text-xl leading-relaxed">${STORIES[id].intro}</p>
            </div>
        `;
        updateUI();
        save();
    }

    // 提示功能
    function getHint() {
        if (state.sanity < 10) {
            appendMsg('grave', "你的理智已不足以承受更多启示。");
            return;
        }
        state.sanity -= 10;
        updateUI();
        const s = STORIES[state.activeId];
        const randomKey = s.keys[Math.floor(Math.random() * s.keys.length)];
        const box = document.getElementById('chat-box');
        const div = document.createElement('div');
        div.className = `flex max-w-4xl mx-auto mb-6 justify-start`;
        div.innerHTML = `<div class="bg-yellow-500/10 text-yellow-500 border border-yellow-500/20 px-8 py-4 rounded-2xl shadow-lg text-lg italic">
            <span class="font-bold block mb-1 text-sm not-italic">● 守墓人的低语</span>
            你应该多关注一下『${randomKey}』。
        </div>`;
        box.appendChild(div);
        box.scrollTop = box.scrollHeight;
    }

    function handleAsk() {
        const input = document.getElementById('user-input');
        const q = input.value.trim();
        if(!q) return;
        appendMsg('user', q);
        input.value = '';
        setTimeout(() => {
            const isMatch = STORIES[state.activeId].keys.some(k => q.includes(k));
            appendMsg('grave', isMatch ? "是。" : (Math.random() > 0.5 ? "不是。" : "无关。"));
        }, 500);
    }

    function appendMsg(role, text) {
        const box = document.getElementById('chat-box');
        const div = document.createElement('div');
        div.className = `flex max-w-4xl mx-auto mb-6 ${role === 'user' ? 'justify-end' : 'justify-start'}`;
        div.innerHTML = `<div class="${role === 'user' ? 'bg-zinc-800 text-white' : 'bg-primary/20 text-primary border border-primary/20'} px-8 py-4 rounded-2xl shadow-lg text-lg">${text}</div>`;
        box.appendChild(div);
        box.scrollTop = box.scrollHeight;
    }

    function confirmTruth() {
        document.getElementById('truth-content').innerText = STORIES[state.activeId].truth;
        document.getElementById('modal-truth').classList.remove('hidden');
    }

    function unlockNextAndClose() {
        if (state.activeId + 1 === state.unlocked && state.unlocked < STORIES.length) state.unlocked++;
        state.sanity = Math.min(100, state.sanity + 20); // 过关恢复点SAN
        document.getElementById('modal-truth').classList.add('hidden');
        updateUI();
        save();
    }

    function toggleSettings(show) { document.getElementById('settings-modal').style.display = show ? 'flex' : 'none'; }
    function resetGame() { if(confirm("确定要抹除所有灵魂印记吗？")) { localStorage.clear(); location.reload(); } }
    function save() { localStorage.setItem('soup_pro_v2', JSON.stringify(state)); }
    function updateUI() { document.getElementById('sanity-display').innerText = `SAN ${state.sanity}`; }
    function toggleMusic() { const m = document.getElementById('bg-music'); m.paused ? m.play() : m.pause(); }

</script>
</body>
</html>
